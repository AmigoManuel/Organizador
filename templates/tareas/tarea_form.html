{% extends 'hogar/dashboard.html' %}

{% load static %}

{% block content %}
    <!--Esta plantilla es utilizada por las vistas CrearTarea , AsignarTarea-->
    <div class="jumbotron">
        <div class="sub-container">
            {% if name == "Asignar Tarea" %}
                <h1 class="display-4">Asignar Tarea</h1>
                <p class="lead">Aquí podras asignar a un usuario una tarea ya creada.</p>
            {% elif name == "Añadir Nueva Tarea" %}
                <h1 class="display-4">Nueva Tarea</h1>
                <p class="lead">Aquí podras crear nuevas tareas sin la necesidad de especificar quien la realiza, la dificultadad el<br>
                    sistema la otorga en base a la complejidad y el tiempo que se requiera para completarla.
                </p>
            {% endif %}
        </div>
        <div id="dummy"></div>
        <div class="card-deck">
            <div class="card border-primary mb-3" style="max-width: 20rem;">
                <div class="card-header">{{ name }}</div>
                <div class="card-body">
                    {% include 'tareas/formularios_crear_tarea/nueva_tarea.html' %}
                </div>
            </div>
            <div class="card border-primary mb-3" style="max-width: 30rem;">
                {% include 'tareas/formularios_crear_tarea/tarea_rapida.html' %}
            </div>
            {% if name == "Añadir Nueva Tarea" %}
                <div class="card border-primary mb-3" style="max-width: 25rem;">
                    {% include 'tareas/formularios_crear_tarea/crear_tarea_rapida.html' %}
                </div>
            {% endif %}
        </div>
        {% if name == "Asignar Tarea" %}
            <a class="btn btn-success btn-lg" href="../crear/">Crear Tarea
                <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-hand-index" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd"
                          d="M6.75 1a.75.75 0 0 0-.75.75V9a.5.5 0 0 1-1 0v-.89l-1.003.2a.5.5 0 0 0-.399.546l.345 3.105a1.5 1.5 0 0 0 .243.666l1.433 2.15a.5.5 0 0 0 .416.223h6.385a.5.5 0 0 0 .434-.252l1.395-2.442a2.5 2.5 0 0 0 .317-.991l.272-2.715a1 1 0 0 0-.995-1.1H13.5v1a.5.5 0 0 1-1 0V7.154a4.208 4.208 0 0 0-.2-.26c-.187-.222-.368-.383-.486-.43-.124-.05-.392-.063-.708-.039a4.844 4.844 0 0 0-.106.01V8a.5.5 0 0 1-1 0V5.986c0-.167-.073-.272-.15-.314a1.657 1.657 0 0 0-.448-.182c-.179-.035-.5-.04-.816-.027l-.086.004V8a.5.5 0 0 1-1 0V1.75A.75.75 0 0 0 6.75 1zM8.5 4.466V1.75a1.75 1.75 0 0 0-3.5 0v5.34l-1.199.24a1.5 1.5 0 0 0-1.197 1.636l.345 3.106a2.5 2.5 0 0 0 .405 1.11l1.433 2.15A1.5 1.5 0 0 0 6.035 16h6.385a1.5 1.5 0 0 0 1.302-.756l1.395-2.441a3.5 3.5 0 0 0 .444-1.389l.272-2.715a2 2 0 0 0-1.99-2.199h-.582a5.184 5.184 0 0 0-.195-.248c-.191-.229-.51-.568-.88-.716-.364-.146-.846-.132-1.158-.108l-.132.012a1.26 1.26 0 0 0-.56-.642 2.634 2.634 0 0 0-.738-.288c-.31-.062-.739-.058-1.05-.046l-.048.002zm2.094 2.025z"/>
                </svg>
            </a>
        {% elif name == "Añadir Nueva Tarea" %}
            <a class="btn btn-success btn-lg" href="../asignar/">Asignar Tarea
                <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-hand-index-thumb" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd"
                          d="M6.75 1a.75.75 0 0 0-.75.75V9.5a.5.5 0 0 1-.854.354l-2.41-2.411a.517.517 0 0 0-.809.631l2.512 4.185 1.232 2.465a.5.5 0 0 0 .447.276h6.302a.5.5 0 0 0 .434-.252l1.395-2.442a2.5 2.5 0 0 0 .317-.991l.272-2.715a1 1 0 0 0-.995-1.1H13.5v1a.5.5 0 1 1-1 0V7.154a4.208 4.208 0 0 0-.2-.26c-.187-.222-.368-.383-.486-.43-.124-.05-.392-.063-.708-.039a4.844 4.844 0 0 0-.106.01V8a.5.5 0 1 1-1 0V5.986c0-.167-.073-.272-.15-.314a1.657 1.657 0 0 0-.448-.182c-.179-.035-.5-.04-.816-.027l-.086.004V8a.5.5 0 1 1-1 0V1.75A.75.75 0 0 0 6.75 1zM8.5 4.466V1.75a1.75 1.75 0 1 0-3.5 0v6.543L3.443 6.736A1.517 1.517 0 0 0 1.07 8.588l2.491 4.153 1.215 2.43A1.5 1.5 0 0 0 6.118 16h6.302a1.5 1.5 0 0 0 1.302-.756l1.395-2.441a3.5 3.5 0 0 0 .444-1.389l.272-2.715a2 2 0 0 0-1.99-2.199h-.582a5.114 5.114 0 0 0-.195-.248c-.191-.229-.51-.568-.88-.716-.364-.146-.846-.132-1.158-.108l-.132.012a1.26 1.26 0 0 0-.56-.642 2.634 2.634 0 0 0-.738-.288c-.31-.062-.739-.058-1.05-.046l-.048.002zm2.094 2.025z"/>
                </svg>
            </a>
        {% endif %}
        <a class="btn btn-info btn-lg" href="../distribuir/">Distribución Rápida
            <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-puzzle-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd"
                      d="M3.112 3.645A1.5 1.5 0 0 1 4.605 2H7a.5.5 0 0 1 .5.5v.382c0 .696-.497 1.182-.872 1.469a.459.459 0 0 0-.115.118.113.113 0 0 0-.012.025L6.5 4.5v.003l.003.01c.004.01.014.028.036.053a.86.86 0 0 0 .27.194C7.09 4.9 7.51 5 8 5c.492 0 .912-.1 1.19-.24a.86.86 0 0 0 .271-.194.213.213 0 0 0 .036-.054l.003-.01v-.008a.112.112 0 0 0-.012-.025.459.459 0 0 0-.115-.118c-.375-.287-.872-.773-.872-1.469V2.5A.5.5 0 0 1 9 2h2.395a1.5 1.5 0 0 1 1.493 1.645L12.645 6.5h.237c.195 0 .42-.147.675-.48.21-.274.528-.52.943-.52.568 0 .947.447 1.154.862C15.877 6.807 16 7.387 16 8s-.123 1.193-.346 1.638c-.207.415-.586.862-1.154.862-.415 0-.733-.246-.943-.52-.255-.333-.48-.48-.675-.48h-.237l.243 2.855A1.5 1.5 0 0 1 11.395 14H9a.5.5 0 0 1-.5-.5v-.382c0-.696.497-1.182.872-1.469a.459.459 0 0 0 .115-.118.113.113 0 0 0 .012-.025L9.5 11.5v-.003l-.003-.01a.214.214 0 0 0-.036-.053.859.859 0 0 0-.27-.194C8.91 11.1 8.49 11 8 11c-.491 0-.912.1-1.19.24a.859.859 0 0 0-.271.194.214.214 0 0 0-.036.054l-.003.01v.002l.001.006a.113.113 0 0 0 .012.025c.016.027.05.068.115.118.375.287.872.773.872 1.469v.382a.5.5 0 0 1-.5.5H4.605a1.5 1.5 0 0 1-1.493-1.645L3.356 9.5h-.238c-.195 0-.42.147-.675.48-.21.274-.528.52-.943.52-.568 0-.947-.447-1.154-.862C.123 9.193 0 8.613 0 8s.123-1.193.346-1.638C.553 5.947.932 5.5 1.5 5.5c.415 0 .733.246.943.52.255.333.48.48.675.48h.238l-.244-2.855z"/>
            </svg>
        </a>
    </div>
{% endblock %}

{% block extrajs %}
    <!-- Crear y eliminar Cookies -->

    <!-- Script de tareas nativas -->
    <script>
        // Formulario
        let tarea_nombre = document.getElementById('id_nombre');
        let tarea_complejidad = document.getElementById('id_complejidad');
        let tarea_dependencia = document.getElementById('id_dependencia');
        let tarea_duracion = document.getElementById('id_duracion');
        let tarea_comentario = document.getElementById('id_comentarios');
        // Dependencias por nombre
        let dependencias_nombre = get_dependencias();
        // Select
        let limpiar_select = document.getElementById("id_nativa_dependencia");
        let comidas_select = document.getElementById("id_nativa_comidas");
        let mascotas_select = document.getElementById("id_nativa_atender");
        //Parametros para crear tarea rapida
        let rapida_nombre = document.getElementById('id_rapida_nombre');
        let rapida_complejidad = document.getElementById('id_rapida_complejidad');
        let rapida_duracion = document.getElementById('id_rapida_duracion');
        let rapida_dependencia = document.getElementById('id_rapida_dependencia');
        let rapida_comentario = document.getElementById('id_rapida_comentario');
        // Tareas rapidas añadidas
        let tareas_custom = document.getElementById('tareas_custom');

        class TareaRapida {
            constructor(nombre, complejidad, duracion, dependencia, comentario) {
                this.nombre = nombre;
                this.complejidad = complejidad;
                this.duracion = duracion;
                this.dependencia = dependencia;
                this.comentario = comentario;
            }
        }

        // Platos a añadir
        let platos = get_platos();
        // Si hay platos en cookies
        if (platos.length > 0) {
            init_platos_select();
        }

        // Tareas a añadir
        let tareas_rapidas = get_tareas_rapidas();
        // Si hay tareas_rapidas en cookies
        if (tareas_rapidas.length > 0) {
            init_tareas_rapidas_html();
        }

        // Almacena dependencias en un arreglo
        function get_dependencias() {
            let array = [];
            for (let i = 0; i < tarea_dependencia.options.length; i++) {
                array.push(tarea_dependencia.options[i].text);
            }
            return array;
        }

        // Va por los platos almacenados en cookies
        function get_platos() {
            try {
                return JSON.parse(Cookies.get('platos'))
            } catch (e) {
                return [];
            }
        }

        function get_tareas_rapidas() {
            try {
                return JSON.parse(Cookies.get('tareas_rapidas'))
            } catch (e) {
                return [];
            }
        }

        function init_platos_select() {
            for (let i = 0; i < platos.length; i++) {
                let option = document.createElement('option');
                option.appendChild(document.createTextNode(platos[i]));
                option.value = platos[i];
                comidas_select.appendChild(option);
            }
        }

        function init_tareas_rapidas_html() {
            for (let i = 0; i < tareas_rapidas.length; i++) {
                // tareas_rapidas[i]
                let div = document.createElement('div');
                div.className = 'row';
                div.style.marginTop = '10px';
                div.innerHTML = `
                        <div class="col col-sm-8 text-right">
                            <label for="id_rapida">` + tareas_rapidas[i].nombre + `</label>
                        </div>
                        <div class="col col-sm-4">
                            <button type="button" class="btn btn-primary btn-lg btn-block" style="font-size: medium;" onclick="custom_tarea(` + i + `);">
                                <span style="font-size: 15px;">Añadir<i class="fas fa-plus" style="margin-left: 5px"></i></span>
                            </button>
                        </div>`;
                tareas_custom.appendChild(div);
            }
        }

        // Añade platos a cookies
        function add_plato(plato) {
            platos = get_platos();
            platos.push(plato);
            Cookies.set('platos', platos);
            set_platos();
        }

        function add_tarea_rapida() {
            let tarea_rapida = new TareaRapida(
                rapida_nombre.value,
                rapida_complejidad.value,
                rapida_duracion.value,
                rapida_dependencia.value,
                rapida_comentario.value
            );
            tareas_rapidas = get_tareas_rapidas();
            tareas_rapidas.push(tarea_rapida);
            Cookies.set('tareas_rapidas', tareas_rapidas);
            location.reload();
        }

        // Actualiza el selector de platos
        function set_platos() {
            let plato = platos[platos.length - 1];
            let option = document.createElement('option');
            option.appendChild(document.createTextNode(plato));
            option.value = plato;
            comidas_select.appendChild(option);
        }

        // Setea dependencias según su nombre
        function set_dependencia(dependencia) {
            tarea_dependencia.selectedIndex = dependencias_nombre.indexOf(dependencia);
        }

        // Procedimiento para limpiar
        function nativa_limpiar() {
            tarea_nombre.value = "Limpiar";
            tarea_complejidad.value = 2;
            tarea_dependencia.value = limpiar_select.value;
            tarea_duracion.value = "01:00";
            tarea_comentario.value = "Debe limpiar " + limpiar_select.options[limpiar_select.value].text;
        }

        // Procedimiento para cocinar
        function nativa_cocinar() {
            tarea_nombre.value = "Cocinar";
            tarea_complejidad.value = 2;
            set_dependencia("Cocina");
            tarea_duracion.value = "01:00";
            tarea_comentario.value = "Debe Cocinar " + comidas_select.value;
        }

        // Procedimiento para atender
        function nativa_atender() {
            tarea_nombre.value = "Atender mascota";
            tarea_complejidad.value = 2;
            set_dependencia("Exterior")
            tarea_duracion.value = "01:00";
            tarea_comentario.value = "Debe Cocinar " + mascotas_select.value;
        }

        function custom_tarea(index) {
            let tarea_rapida = tareas_rapidas[index];
            tarea_nombre.value = tarea_rapida.nombre;
            tarea_complejidad.value = tarea_rapida.complejidad;
            tarea_duracion.value = tarea_rapida.duracion;
            tarea_dependencia.value = tarea_rapida.dependencia;
            tarea_comentario.value = tarea_rapida.comentario;
        }

    </script>

    <!-- Script de alerta -->
    <script>
        if (document.getElementById('id_dependencia').childElementCount === 1) {
            document.getElementById('id_nombre').disabled = true;
            document.getElementById('id_complejidad').disabled = true;
            document.getElementById('id_duracion').disabled = true;
            document.getElementById('id_dependencia').disabled = true;
            document.getElementById('id_comentarios').disabled = true;
            document.getElementById('enviar').disabled = true;
            document.getElementById('dummy').innerHTML = '<div class="alert alert-dismissible alert-warning" style="max-width: 670px"><button type="button" class="close" data-dismiss="alert">&times;</button><h4 class="alert-heading">Atención!</h4><p class="mb-0"></p>Antes de Añadir una tarea es necesario añadir una dependencia al domicilio</div>'
        }
    </script>
{% endblock %}
